% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sampling.R
\name{compute_sample_size}
\alias{compute_sample_size}
\title{Compute required sample size for a proportion (vector or \code{data.table} form)}
\usage{
compute_sample_size(
  p,
  r,
  conf.level = 0.95,
  method = c("wald", "wilson"),
  ceiling_out = TRUE,
  n_upper = 1e+07,
  as_dt = TRUE
)
}
\arguments{
\item{p}{Numeric vector of true or expected proportions (0 < \code{p} < 1).}

\item{r}{Numeric vector of target relative margins of error (0 < \code{r} < 1).}

\item{conf.level}{Confidence level (default: 0.95).}

\item{method}{One of \code{c("wald", "wilson")}.
\itemize{
\item \code{"wald"} uses the closed-form expression
\deqn{n = \frac{z^2 (1 - p)}{r^2 p}}
\item \code{"wilson"} iteratively increases \code{n} until the Wilson half-width â‰¤ \eqn{r \cdot p}.
}}

\item{ceiling_out}{Logical; if \code{TRUE} (default), rounds sample size up to the nearest integer.}

\item{n_upper}{Maximum search bound for the Wilson method (default: \code{1e7}).}

\item{as_dt}{Logical; if \code{TRUE}, returns a \code{data.table} with all parameter
combinations and derived quantities.}
}
\value{
\itemize{
\item If \code{as_dt = FALSE}: a numeric vector of required sample sizes (same length as \code{p}).
\item If \code{as_dt = TRUE}:  a \code{data.table} of class \code{"sample_size"} with columns:
\describe{
\item{p, r, conf.level}{Input parameters.}
\item{n}{Required sample size.}
\item{z}{Critical z-score.}
\item{se}{Standard error.}
\item{ci_lo, ci_hi}{Lower and upper confidence interval bounds.}
\item{band_lo, band_hi}{Relative margin-of-error bands.}
\item{label}{Formatted summary string.}
}
}
}
\description{
Computes the required sample size for given true proportions (\code{p}),
relative margins of error (\code{r}), and confidence levels (\code{conf.level})
using either the \strong{Wald} (closed-form) or \strong{Wilson} (iterative search) method.
}
\details{
By default, returns a numeric vector of sample sizes.
If \code{as_dt = TRUE}, returns a tidy \code{data.table} with additional
derived statistics such as standard error and confidence bounds.

This function provides a unified interface for sample-size estimation
under \emph{relative error} constraints.
When \code{as_dt = TRUE}, the returned \code{"sample_size"} object can be
directly used with visualization helpers such as
\code{plot_sample_size()} or simulation workflows.
}
\examples{
# Vector output
compute_sample_size(0.1, 0.05, method = "wald")
compute_sample_size(0.1, 0.05, method = "wilson")
compute_sample_size(p = c(0.1, 0.2, 0.3), r = 0.05, method = "wald")

# Data-table output with full parameter expansion
compute_sample_size(
  p = c(0.05, 0.1),
  r = c(0.1, 0.2),
  conf.level = c(0.95, 0.99),
  as_dt = TRUE
)

}
