% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/stay.R
\name{limit_stay}
\alias{limit_stay}
\title{Limit Covered Stay Days by Contract Rules}
\usage{
limit_stay(
  df,
  id_var,
  group_var,
  from_var,
  to_var,
  limit,
  waiting,
  deduction = 0
)
}
\arguments{
\item{df}{A data.frame containing the date ranges.}

\item{id_var}{One or more columns identifying the insured ID (bare names).}

\item{group_var}{Additional grouping column(s), e.g. product type (bare names).}

\item{from_var}{Start date column (bare name). Must be of class \code{Date}.}

\item{to_var}{End date column (bare name). Must be of class \code{Date}.}

\item{limit}{Integer. Maximum number of days covered (e.g., \code{180} = up to 180 days).}

\item{waiting}{Integer. Waiting period (days) before coverage begins
(e.g., \code{180} = no benefit in the first 180 days).}

\item{deduction}{Integer. Number of \strong{initial covered days} to deduct
(default \code{0}). Commonly set to \code{90} in practice.}
}
\value{
A data.frame with one row per \verb{(id_var, group_var, month)} containing:
\itemize{
\item \code{from}, \code{to}: start and end of the stay period (after applying contract rules).
\item \code{stay}: total stay days (before contract limits).
\item \code{stay_mod}: modified stay days (after applying limits, waiting, and deductions).
}
}
\description{
Applies insurance contract rules (coverage limit, waiting period, and optional
deduction days) to a set of hospitalization date ranges. This function is designed
for insurance stay analysis, where policies often restrict benefits to a maximum
number of days per period, apply a waiting period, or deduct initial days.
}
\details{
Internally, stay intervals are first expanded into a \strong{binary stay vector}
(one element per day) via \code{\link[=.build_binary_stay_vector]{.build_binary_stay_vector()}}. Then contract rules
are applied in C (\code{LimitStay}) for efficiency.
\itemize{
\item Typical insurance settings: \code{limit = 180}, \code{waiting = 180}, \code{deduction = 90}.
\item If multiple stays exist in a month, they are aggregated.
\item Deduction days are applied after limit/waiting adjustments.
\item Overlapping intervals should be merged beforehand; use \code{\link[=collapse_date_ranges]{collapse_date_ranges()}}.
\item \strong{Results are summarized and returned at the monthly level} for performance,
not at the raw daily level.
}
}
\examples{
\donttest{
dt <- data.frame(
  id    = c(1, 1, 1, 2, 2),
  group = c("A", "A", "A", "B", "B"),
  from  = as.Date(c("2024-01-01", "2024-07-01", "2024-12-01",
                    "2024-02-01", "2024-02-15")),
  to    = as.Date(c("2024-01-20", "2024-07-10", "2024-12-15",
                    "2024-02-10", "2025-02-20"))
)

# Apply insurance contract rules: 180-day limit, 180-day waiting, 90-day deduction
limit_stay(dt, id, group, from, to,
           limit = 180, waiting = 180, deduction = 90)
}

}
